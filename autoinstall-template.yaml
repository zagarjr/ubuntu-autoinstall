autoinstall:
  version: 1
  early-commands:
    # Download and execute pre-install.sh script
    - curl -o /tmp/pre-install.sh http://example.com/pre-install.sh
    - chmod +x /tmp/pre-install.sh
    - /tmp/pre-install.sh
    - rm /tmp/pre-install.sh

  identity:
    hostname: ubuntu
    username: user
    password: $crypted_password  # Replace with actual encrypted password

  keyboard: {layout: us, variant: ''}

  locale: en_US.UTF-8

  network:
    network:
      version: 2
      ethernets:
        ens160:
          dhcp4: yes

  proxy: {}

  apt:
    preserve_sources_list: false
    primary:
    - arches: [amd64, i386]
      uri: http://archive.ubuntu.com/ubuntu
    - arches: [default]
      uri: http://ports.ubuntu.com/ubuntu-ports
    security: # This is an example security pocket.
    - arches: [amd64, i386]
      uri: http://security.ubuntu.com/ubuntu
    - arches: [default]
      uri: http://ports.ubuntu.com/ubuntu-ports

  packages:
    - ubuntu-desktop

  late-commands:
    - curtin in-target --target=/target -- wget -O /target/etc/resolv.conf http://8.8.8.8

  # Storage section placed after late-commands
  storage:
    config:
      # Placeholder for disk and LVM configuration
      # This section will be dynamically generated by pre-install.sh script
